# Optima BI å¼€å‘è·¯çº¿å›¾

> æœ¬æ–‡æ¡£å®šä¹‰äº† optima-bi çš„å¼€å‘é˜¶æ®µã€é‡Œç¨‹ç¢‘å’Œäº¤ä»˜è®¡åˆ’

## âš ï¸ é‡è¦æ›´æ–°ï¼ˆåŸºäºä¸“å®¶è¯„å®¡ï¼‰

**ä¸“å®¶è¯„å®¡ç»“æœ**: 6.7/10 - å¯è¡Œä½†éœ€è¦é‡å¤§æ”¹è¿›

**å…³é”®é—®é¢˜**: OLTP/OLAP æ··ç”¨å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼ˆè¯¦è§ [ä¸“å®¶è¯„å®¡æŠ¥å‘Š](./expert-review.md)ï¼‰

**å¿…é¡»å®æ–½ï¼ˆP0ï¼‰**:
- ğŸ”´ **é¢„èšåˆè¡¨**ï¼ˆdaily/weekly/monthly summariesï¼‰
- ğŸ”´ **å¤šå±‚ç¼“å­˜æ¶æ„**ï¼ˆL1 å†…å­˜ + L2 Redis + L3 é¢„èšåˆè¡¨ï¼‰
- ğŸ”´ **æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–**
- ğŸ”´ **ETL æ›´æ–°ç­–ç•¥**ï¼ˆæ¯å°æ—¶å¢é‡ï¼‰
- ğŸ”´ **æ€§èƒ½æµ‹è¯•**ï¼ˆåŸºå‡†æµ‹è¯• + å‹åŠ›æµ‹è¯•ï¼‰

**æ—¶é—´å½±å“**: +2 å‘¨ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

---

## ğŸ“… æ€»ä½“æ—¶é—´çº¿ï¼ˆä¿®è®¢ç‰ˆï¼‰

| é˜¶æ®µ | å‘¨æœŸ | æ ¸å¿ƒç›®æ ‡ | çŠ¶æ€ |
|------|------|---------|------|
| **Phase 0** | 1 å‘¨ | æ–‡æ¡£å’Œè§„åˆ’ | âœ… å·²å®Œæˆ |
| **Phase 1** | 3-4 å‘¨ | MVP + æ€§èƒ½æ¶æ„ | ğŸ”œ å¾…å¼€å§‹ |
| **Phase 2** | 2 å‘¨ | å¹³å°åŠŸèƒ½ | â³ è®¡åˆ’ä¸­ |
| **Phase 3** | 1 å‘¨ | æµ‹è¯•å’Œéƒ¨ç½² | â³ è®¡åˆ’ä¸­ |

**æ€»è®¡**: **7-10 å‘¨**ï¼ˆåŸè®¡åˆ’ 6-7 å‘¨ï¼Œå¢åŠ  2 å‘¨æ€§èƒ½ä¼˜åŒ–ï¼‰

---

## âœ… Phase 0: æ–‡æ¡£å’Œè§„åˆ’ï¼ˆå·²å®Œæˆï¼‰

**æ—¶é—´**: å·²å®Œæˆ
**ç›®æ ‡**: å®Œå–„æŠ€æœ¯æ–¹æ¡ˆï¼Œç ”ç©¶ç”Ÿæ€ç³»ç»Ÿï¼Œåˆ¶å®šæ¶æ„å†³ç­–

### äº¤ä»˜ç‰©
- âœ… äº§å“éœ€æ±‚æ–‡æ¡£ï¼ˆPRDï¼‰
- âœ… æŠ€æœ¯è®¾è®¡æ–‡æ¡£ï¼ˆTech Designï¼‰
- âœ… ç ”ç©¶æ€»ç»“æ–‡æ¡£ï¼ˆResearch Summaryï¼‰
- âœ… æ¶æ„å†³ç­–è®°å½•ï¼ˆ5 ä¸ª ADRï¼‰
- âœ… README æ›´æ–°

### å…³é”®æˆæœ
- ç¡®å®šæŠ€æœ¯æ ˆï¼šTypeScript + Fastify + Prisma
- ç¡®å®šè®¤è¯æ–¹å¼ï¼šOAuth 2.0 Device Flow
- ç¡®å®šæ•°æ®è®¿é—®ï¼šç›´æ¥è¿æ¥ PostgreSQLï¼ˆåªè¯»ï¼‰
- å®šä¹‰è¾“å‡ºæ ¼å¼ï¼šJSON é»˜è®¤ + Pretty é€‰é¡¹
- æ˜ç¡®æ•°æ®æ¨¡å‹ï¼š7 å¼ æ ¸å¿ƒè¡¨ï¼Œ6 ä¸ªåˆ†æç»´åº¦

---

## ğŸ¯ Phase 1: MVP + æ€§èƒ½æ¶æ„ï¼ˆ3-4 å‘¨ï¼‰

**ç›®æ ‡**: å®ç°å•†å®¶çº§åŸºç¡€ BI åˆ†æåŠŸèƒ½ï¼Œéƒ¨ç½²æ€§èƒ½ä¼˜åŒ–æ¶æ„ï¼Œæ”¯æŒ Claude Code é›†æˆ

**âš ï¸ æ›´æ–°è¯´æ˜**: æ ¹æ®[ä¸“å®¶è¯„å®¡](./expert-review.md)ï¼Œå¢åŠ  Week 3.5 ä¸“é—¨å®æ–½æ€§èƒ½ä¼˜åŒ–ï¼ˆP0 å¿…é¡»é¡¹ï¼‰

### Week 1: é¡¹ç›®åŸºç¡€è®¾æ–½

#### 1.1 é¡¹ç›®ç»“æ„æ­å»º
- [ ] åˆ›å»º monorepo ç»“æ„ï¼ˆpackages/bi-cli, packages/bi-backendï¼‰
- [ ] é…ç½® TypeScriptã€ESLintã€Prettier
- [ ] é…ç½® package.json å’Œ tsconfig.json
- [ ] è®¾ç½® Git hooksï¼ˆhusky + lint-stagedï¼‰

#### 1.2 bi-backend åŸºç¡€æ¡†æ¶
- [ ] åˆå§‹åŒ– Fastify åº”ç”¨
- [ ] é…ç½® Prismaï¼ˆè¿æ¥ commerce-backend DBï¼‰
- [ ] ç”Ÿæˆ Prisma schemaï¼ˆ`prisma db pull`ï¼‰
- [ ] å®ç°è®¤è¯ä¸­é—´ä»¶ï¼ˆè°ƒç”¨ user-authï¼‰
- [ ] å®ç°æƒé™ä¸­é—´ä»¶ï¼ˆrequireAdminï¼‰
- [ ] é…ç½® Redis å®¢æˆ·ç«¯
- [ ] é…ç½®ç¯å¢ƒå˜é‡å’Œæ—¥å¿—ï¼ˆpinoï¼‰

**é¢„æœŸè¾“å‡º**:
```bash
# é¡¹ç›®ç»“æ„
optima-bi/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ bi-cli/
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â””â”€â”€ bi-backend/
â”‚       â”œâ”€â”€ src/
â”‚       â”œâ”€â”€ prisma/schema.prisma
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ tsconfig.json
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ package.json (workspace root)
```

#### 1.3 bi-cli åŸºç¡€æ¡†æ¶
- [ ] åˆå§‹åŒ– Commander.js CLI
- [ ] å®ç°é…ç½®ç®¡ç†ï¼ˆconf åŠ å¯†å­˜å‚¨ï¼‰
- [ ] å®ç°å¤šç¯å¢ƒæ”¯æŒï¼ˆproduction/stage/developmentï¼‰
- [ ] å®ç° HTTP å®¢æˆ·ç«¯ï¼ˆaxios + æ‹¦æˆªå™¨ï¼‰
- [ ] å®ç°è¾“å‡ºæ ¼å¼åˆ‡æ¢ï¼ˆJSON / Prettyï¼‰

**é¢„æœŸè¾“å‡º**:
```bash
bi-cli --help
bi-cli config list
bi-cli config set backend-url https://bi-api.optima.chat
```

### Week 2: è®¤è¯å’Œæ ¸å¿ƒ API

#### 2.1 OAuth è®¤è¯æµç¨‹ï¼ˆbi-cliï¼‰
- [ ] å®ç° Device Flow è®¤è¯ï¼ˆ`auth login`ï¼‰
  - [ ] è¯·æ±‚ Device Code
  - [ ] æ˜¾ç¤ºæˆæƒ URL å’Œç”¨æˆ·ä»£ç 
  - [ ] è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  - [ ] è½®è¯¢è·å– Token
  - [ ] åŠ å¯†å­˜å‚¨ Token
- [ ] å®ç° Token è‡ªåŠ¨åˆ·æ–°
- [ ] å®ç° `auth logout` å‘½ä»¤
- [ ] å®ç° `auth whoami` å‘½ä»¤
- [ ] å®ç° `auth switch --env` å‘½ä»¤

**æµ‹è¯•éªŒè¯**:
```bash
bi-cli auth login --env development
bi-cli auth whoami
# è¾“å‡º: merchant@example.com (merchant)
```

#### 2.2 é”€å”®åˆ†æ APIï¼ˆå•†å®¶çº§ï¼‰
- [ ] **bi-backend**: å®ç° `/api/v1/sales` ç«¯ç‚¹
  - [ ] æŸ¥è¯¢ orders è¡¨ï¼ˆæŒ‰ merchant_id è¿‡æ»¤ï¼‰
  - [ ] èšåˆè®¡ç®—ï¼ˆæ€»é”€å”®é¢ã€è®¢å•æ•°ã€å®¢å•ä»·ï¼‰
  - [ ] æŒ‰æ—¥æœŸåˆ†ç»„
  - [ ] Redis ç¼“å­˜ï¼ˆ5 åˆ†é’Ÿ TTLï¼‰
- [ ] **bi-cli**: å®ç° `sales get` å‘½ä»¤
  - [ ] æ”¯æŒ `--days` å‚æ•°
  - [ ] æ”¯æŒ `--start` / `--end` å‚æ•°
  - [ ] JSON å’Œ Pretty è¾“å‡º

**æµ‹è¯•éªŒè¯**:
```bash
bi-cli sales get --days 7
# è¾“å‡º: JSON æ ¼å¼çš„é”€å”®æ•°æ®

bi-cli sales get --days 7 --pretty
# è¾“å‡º: å½©è‰²è¡¨æ ¼
```

### Week 3: æ‰©å±•åˆ†æåŠŸèƒ½

#### 3.1 å®¢æˆ·åˆ†æï¼ˆå•†å®¶çº§ï¼‰
- [ ] **bi-backend**: `/api/v1/customers` ç«¯ç‚¹
  - [ ] æŒ‰ customer_email èšåˆè®¢å•
  - [ ] è®¡ç®—æ–°å®¢æˆ·ã€å¤è´­å®¢æˆ·ã€æµå¤±å®¢æˆ·
  - [ ] è®¡ç®— LTVã€å¤è´­ç‡
- [ ] **bi-cli**: `customer get` å‘½ä»¤
  - [ ] æ”¯æŒ `--segment` å‚æ•°ï¼ˆnew/repeat/churned/vipï¼‰
  - [ ] æ”¯æŒ `--period` å‚æ•°

#### 3.2 åº“å­˜åˆ†æï¼ˆå•†å®¶çº§ï¼‰
- [ ] **bi-backend**: `/api/v1/inventory` ç«¯ç‚¹
  - [ ] æŸ¥è¯¢ products è¡¨
  - [ ] ä½åº“å­˜é¢„è­¦ï¼ˆstock_quantity < thresholdï¼‰
  - [ ] åº“å­˜å‘¨è½¬ç‡è®¡ç®—
- [ ] **bi-cli**: `inventory get` å‘½ä»¤
  - [ ] æ”¯æŒ `--status` å‚æ•°ï¼ˆlow/out/overstockï¼‰

#### 3.3 å•†å“åˆ†æï¼ˆå•†å®¶çº§ï¼‰
- [ ] **bi-backend**: `/api/v1/products/top` ç«¯ç‚¹
  - [ ] ä» order_items èšåˆå•†å“é”€é‡
  - [ ] æŒ‰é”€å”®é¢/é”€é‡æ’åº
- [ ] **bi-cli**: `product top` å‘½ä»¤
  - [ ] æ”¯æŒ `--sort-by` å‚æ•°ï¼ˆrevenue/quantityï¼‰

### Week 3 äº¤ä»˜ç‰©

**åŠŸèƒ½æ¸…å•**:
- âœ… OAuth 2.0 Device Flow è®¤è¯
- âœ… é”€å”®åˆ†æï¼ˆå•†å®¶çº§ï¼‰
- âœ… å®¢æˆ·åˆ†æï¼ˆå•†å®¶çº§ï¼‰
- âœ… åº“å­˜åˆ†æï¼ˆå•†å®¶çº§ï¼‰
- âœ… å•†å“åˆ†æï¼ˆå•†å®¶çº§ï¼‰
- âœ… JSON å’Œ Pretty åŒè¾“å‡ºæ¨¡å¼

**æµ‹è¯•éªŒè¯**:
```bash
# è®¤è¯æµç¨‹
bi-cli auth login --env development
bi-cli auth whoami

# æ•°æ®åˆ†æ
bi-cli sales get --days 30
bi-cli customer get --segment churned
bi-cli inventory get --status low
bi-cli product top --limit 10

# Pretty æ¨¡å¼
bi-cli sales get --days 7 --pretty
```

---

### Week 3.5-4: æ€§èƒ½ä¼˜åŒ–æ¶æ„ï¼ˆğŸ”´ P0 - å¿…é¡»ï¼‰

> **âš ï¸ æ–°å¢å‘¨æœŸ**: æ ¹æ®[ä¸“å®¶è¯„å®¡](./expert-review.md)ï¼Œæ€§èƒ½ä¼˜åŒ–ä»"å¯é€‰ Phase 2"æå‡ä¸º"å¿…é¡» P0"

**ç›®æ ‡**: è§£å†³ OLTP/OLAP æ··ç”¨é—®é¢˜ï¼Œå®ç° 10-100 å€æ€§èƒ½æå‡

è¯¦ç»†æ–¹æ¡ˆï¼š[ADR-006: é¢„èšåˆè¡¨](./architecture/adr-006-materialized-views.md) | [æ€§èƒ½ä¼˜åŒ–æŒ‡å—](./performance-optimization.md)

#### 4.1 åˆ›å»ºé¢„èšåˆè¡¨ï¼ˆ3-5 å¤©ï¼‰

- [ ] **daily_merchant_summary** è¡¨è®¾è®¡å’Œåˆ›å»º
  ```sql
  CREATE TABLE daily_merchant_summary (
    merchant_id UUID NOT NULL,
    date DATE NOT NULL,
    total_revenue DECIMAL(10, 2),
    order_count INT,
    unique_customers INT,
    ...
    PRIMARY KEY (merchant_id, date)
  );
  ```
- [ ] **weekly_product_summary** è¡¨è®¾è®¡å’Œåˆ›å»º
- [ ] **monthly_customer_summary** è¡¨è®¾è®¡å’Œåˆ›å»º
- [ ] åˆ›å»ºå¿…è¦ç´¢å¼•
  ```sql
  CREATE INDEX idx_daily_summary_merchant_date
  ON daily_merchant_summary(merchant_id, date DESC);
  ```

#### 4.2 å®ç° ETL æ›´æ–°è„šæœ¬ï¼ˆ2 å¤©ï¼‰

- [ ] ç¼–å†™å¢é‡æ›´æ–° SQL è„šæœ¬
  - [ ] å†å²æ•°æ®æ›´æ–°ï¼ˆæ˜¨å¤©åŠä»¥å‰ï¼‰
  - [ ] ä»Šæ—¥æ•°æ®å¢é‡æ›´æ–°
- [ ] é…ç½® Cron Jobï¼ˆæ¯å°æ—¶æ‰§è¡Œï¼‰
  ```bash
  # crontab
  0 * * * * /path/to/etl-update-daily.sh
  0 1 * * * /path/to/etl-update-historical.sh
  ```
- [ ] å®ç°æ•°æ®è´¨é‡æ£€æŸ¥
- [ ] å®ç°é”™è¯¯å¤„ç†å’Œé‡è¯•é€»è¾‘
- [ ] ç›‘æ§ ETL æ‰§è¡ŒçŠ¶æ€

#### 4.3 å®ç°å¤šå±‚ç¼“å­˜æ¶æ„ï¼ˆ2-3 å¤©ï¼‰

- [ ] **L1 å†…å­˜ç¼“å­˜**ï¼ˆnode-cacheï¼‰
  ```typescript
  const memCache = new NodeCache({ stdTTL: 60 }); // 1 åˆ†é’Ÿ
  ```
- [ ] **L2 Redis ç¼“å­˜**ï¼ˆioredisï¼‰
  ```typescript
  await redis.set(key, JSON.stringify(data), 'EX', 300); // 5 åˆ†é’Ÿ
  ```
- [ ] **L3 é¢„èšåˆè¡¨æŸ¥è¯¢**ï¼ˆä¼˜å…ˆï¼‰
  ```typescript
  const data = await prisma.dailyMerchantSummary.findMany({
    where: { merchantId, date: { gte: startDate } }
  });
  ```
- [ ] **L4 åŸå§‹è¡¨æŸ¥è¯¢**ï¼ˆfallbackï¼‰
- [ ] å®ç°åˆ†å¸ƒå¼é”ï¼ˆé˜²æ­¢ç¼“å­˜å‡»ç©¿ï¼‰
  ```typescript
  const lock = await redis.set(lockKey, '1', 'EX', 10, 'NX');
  ```

#### 4.4 æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–ï¼ˆ1 å¤©ï¼‰

- [ ] è®¢å•è¡¨ç´¢å¼•
  ```sql
  CREATE INDEX idx_orders_merchant_created_status
  ON orders(merchant_id, created_at, status)
  WHERE status IN ('paid', 'delivered');
  ```
- [ ] è®¢å•æ˜ç»†è¡¨ç´¢å¼•
  ```sql
  CREATE INDEX idx_order_items_product
  ON order_items(product_id, order_id);
  ```
- [ ] å•†å“è¡¨ç´¢å¼•
- [ ] é¢„èšåˆè¡¨ç´¢å¼•
- [ ] ä½¿ç”¨ `EXPLAIN ANALYZE` éªŒè¯ç´¢å¼•æ•ˆæœ

#### 4.5 æŸ¥è¯¢é€»è¾‘é‡æ„ï¼ˆ1-2 å¤©ï¼‰

- [ ] é‡æ„ bi-backend æŸ¥è¯¢æœåŠ¡
  - [ ] ä¼˜å…ˆæŸ¥è¯¢é¢„èšåˆè¡¨ï¼ˆå†å²æ•°æ®ï¼‰
  - [ ] æŸ¥è¯¢åŸå§‹è¡¨ï¼ˆä»Šæ—¥æ•°æ®ï¼‰
  - [ ] åˆå¹¶æ•°æ®è¿”å›
- [ ] å®ç°ç¼“å­˜é›†æˆ
- [ ] å®ç°æ€§èƒ½ç›‘æ§åŸ‹ç‚¹
  ```typescript
  logger.info({
    type: 'query_metrics',
    duration,
    cacheHit: true,
    dataSource: 'L2_REDIS'
  });
  ```

#### 4.6 æ€§èƒ½æµ‹è¯•ï¼ˆ2-3 å¤©ï¼‰

- [ ] **åŸºå‡†æµ‹è¯•**ï¼ˆApache Benchï¼‰
  ```bash
  ab -n 1000 -c 10 \
    -H "Authorization: Bearer <token>" \
    https://bi-api.optima.chat/api/v1/sales?days=7
  ```
  - ç›®æ ‡: Requests/sec > 50, P99 < 2s
- [ ] **å‹åŠ›æµ‹è¯•**ï¼ˆk6ï¼‰
  ```bash
  k6 run load-test.js
  # 50 å¹¶å‘ â†’ 100 å¹¶å‘ â†’ 200 å¹¶å‘
  ```
- [ ] **æ•°æ®è§„æ¨¡æµ‹è¯•**ï¼ˆç™¾ä¸‡çº§è®¢å•ï¼‰
  - åˆ›å»º 100 ä¸‡æ¡æµ‹è¯•è®¢å•
  - éªŒè¯æŸ¥è¯¢æ€§èƒ½ < 200ms
- [ ] **ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š**
  - ä¼˜åŒ–å‰ vs ä¼˜åŒ–åå¯¹æ¯”
  - ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡
  - æ…¢æŸ¥è¯¢åˆ†æ

### Week 3.5-4 äº¤ä»˜ç‰©

**æ€§èƒ½æ¶æ„**:
- âœ… é¢„èšåˆè¡¨ï¼ˆ3 å¼ è¡¨ï¼‰
- âœ… ETL æ›´æ–°è„šæœ¬ï¼ˆæ¯å°æ—¶ï¼‰
- âœ… å¤šå±‚ç¼“å­˜ï¼ˆL1+L2+L3+L4ï¼‰
- âœ… æ•°æ®åº“ç´¢å¼•ï¼ˆ10+ ä¸ªç´¢å¼•ï¼‰
- âœ… åˆ†å¸ƒå¼é”ï¼ˆé˜²æ­¢ç¼“å­˜å‡»ç©¿ï¼‰

**æ€§èƒ½æŒ‡æ ‡**ï¼ˆå¿…é¡»è¾¾åˆ°ï¼‰:
- âœ… API å“åº”æ—¶é—´ P50 < 500ms
- âœ… API å“åº”æ—¶é—´ P99 < 2s
- âœ… ç¼“å­˜å‘½ä¸­ç‡ > 70%
- âœ… æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ < 200ms
- âœ… æ€§èƒ½æå‡ 10-100 å€ï¼ˆ2-5s â†’ 50-200msï¼‰

**æµ‹è¯•éªŒè¯**:
```bash
# æ€§èƒ½æµ‹è¯•
ab -n 1000 -c 10 https://bi-api.optima.chat/api/v1/sales?days=7

# æŸ¥çœ‹ç¼“å­˜å‘½ä¸­
bi-cli sales get --days 7 --debug
# è¾“å‡º: Cache hit: L2_REDIS, Duration: 45ms

# æŸ¥çœ‹é¢„èšåˆè¡¨æ•°æ®
psql -c "SELECT * FROM daily_merchant_summary WHERE merchant_id='xxx' LIMIT 5;"
```

---

## ğŸš€ Phase 2: å¹³å°åŠŸèƒ½ï¼ˆ2 å‘¨ï¼‰

**ç›®æ ‡**: å®ç°å¹³å°çº§ç®¡ç†å‘˜åˆ†æåŠŸèƒ½ï¼Œå®Œå–„é”™è¯¯å¤„ç†å’Œæ–‡æ¡£

**âš ï¸ æ›´æ–°è¯´æ˜**: æ€§èƒ½ä¼˜åŒ–å·²å‰ç§»è‡³ Phase 1ï¼ˆWeek 3.5-4ï¼‰ï¼ŒPhase 2 ä¸“æ³¨äºå¹³å°åŠŸèƒ½

### Week 5: å¹³å°åˆ†æåŠŸèƒ½

#### 5.1 å¹³å°æ¦‚è§ˆï¼ˆç®¡ç†å‘˜ï¼‰
- [ ] **bi-backend**: `/api/v1/platform/overview` ç«¯ç‚¹
  - [ ] è®¡ç®—å¹³å° GMV
  - [ ] ç»Ÿè®¡æ´»è·ƒå•†å®¶æ•°é‡
  - [ ] ç»Ÿè®¡è®¢å•æ€»é‡
  - [ ] åŒæ¯”/ç¯æ¯”å¢é•¿ç‡
- [ ] **bi-cli**: `platform overview` å‘½ä»¤
  - [ ] éœ€è¦ç®¡ç†å‘˜æƒé™éªŒè¯
  - [ ] æ”¯æŒ `--month` å‚æ•°

#### 5.2 å•†å®¶åˆ†æï¼ˆç®¡ç†å‘˜ï¼‰
- [ ] **bi-backend**: `/api/v1/platform/merchants` ç«¯ç‚¹
  - [ ] å•†å®¶åˆ†å±‚ï¼ˆæ´»è·ƒ/ä¼‘çœ /æµå¤±ï¼‰
  - [ ] å•†å®¶ GMV æ’è¡Œ
  - [ ] å•†å®¶å¢é•¿è¶‹åŠ¿
- [ ] **bi-cli**: `platform merchants` å‘½ä»¤
  - [ ] æ”¯æŒ `--segment` å‚æ•°ï¼ˆactive/sleeping/churned/topï¼‰

#### 5.3 è®¢é˜…åˆ†æï¼ˆç®¡ç†å‘˜ï¼‰
- [ ] **bi-backend**: `/api/v1/platform/subscription` ç«¯ç‚¹
  - [ ] è®¡ç®— MRRï¼ˆMonthly Recurring Revenueï¼‰
  - [ ] è®¡ç®— ARRï¼ˆAnnual Recurring Revenueï¼‰
  - [ ] è®¡ç®—æµå¤±ç‡ï¼ˆChurn Rateï¼‰
  - [ ] æŒ‰è®¡åˆ’åˆ†ç»„ï¼ˆfree/pro/enterpriseï¼‰
- [ ] **bi-cli**: `platform subscription` å‘½ä»¤
  - [ ] æ”¯æŒ `--plan` å‚æ•°
  - [ ] æ”¯æŒ `--metrics` å‚æ•°ï¼ˆmrr,arr,churnï¼‰

#### 5.4 è´¢åŠ¡åˆ†æï¼ˆç®¡ç†å‘˜ï¼‰
- [ ] **bi-backend**: `/api/v1/platform/revenue` ç«¯ç‚¹
  - [ ] å¹³å°æ‰‹ç»­è´¹æ”¶å…¥ç»Ÿè®¡
  - [ ] è®¢é˜…æ”¶å…¥ç»Ÿè®¡
  - [ ] è½¬è´¦æ±‡æ€»
- [ ] **bi-cli**: `platform revenue` å‘½ä»¤
  - [ ] æ”¯æŒ `--breakdown` é€‰é¡¹ï¼ˆç»†åˆ†æ”¶å…¥æ¥æºï¼‰

#### 5.5 ç®¡ç†å‘˜æƒé™æ‰©å±•
- [ ] æ”¯æŒ `--merchant-id` å‚æ•°æŸ¥çœ‹æŒ‡å®šå•†å®¶æ•°æ®
  ```bash
  bi-cli sales get --merchant-id merchant_xxx --days 30
  bi-cli customer get --merchant-id merchant_xxx --segment all
  ```

### Week 6: å®Œå–„å’Œæ–‡æ¡£

#### 6.1 åˆ†é¡µå’Œè¿‡æ»¤
- [ ] åˆ†é¡µæ”¯æŒ
  - [ ] æ‰€æœ‰åˆ—è¡¨æ¥å£æ”¯æŒ `--limit` å’Œ `--page` å‚æ•°
- [ ] è¿‡æ»¤å’Œæ’åº
  - [ ] æ”¯æŒ `--sort-by` å’Œ `--order` å‚æ•°

#### 6.2 é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- [ ] ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
  ```json
  {
    "success": false,
    "error": {
      "code": "UNAUTHORIZED",
      "message": "Invalid token",
      "details": "Token has expired"
    }
  }
  ```
- [ ] å®Œå–„æ—¥å¿—è®°å½•ï¼ˆpinoï¼‰
  - [ ] è¯·æ±‚æ—¥å¿—ï¼ˆAPI ç«¯ç‚¹ã€è€—æ—¶ï¼‰
  - [ ] é”™è¯¯æ—¥å¿—ï¼ˆå †æ ˆè·Ÿè¸ªï¼‰
  - [ ] ç¼“å­˜å‘½ä¸­æ—¥å¿—
- [ ] bi-cli é”™è¯¯å¤„ç†
  - [ ] å‹å¥½çš„é”™è¯¯æç¤º
  - [ ] ç½‘ç»œè¶…æ—¶é‡è¯•
  - [ ] Token è¿‡æœŸè‡ªåŠ¨åˆ·æ–°

#### 6.3 æ–‡æ¡£å®Œå–„
- [ ] ç”Ÿæˆ OpenAPI æ–‡æ¡£ï¼ˆ@fastify/swaggerï¼‰
- [ ] åˆ›å»º API å‚è€ƒæ–‡æ¡£
- [ ] æ›´æ–° README çš„ä½¿ç”¨ç¤ºä¾‹
- [ ] åˆ›å»ºæ•…éšœæ’æŸ¥æŒ‡å—

### Phase 2 äº¤ä»˜ç‰©

**åŠŸèƒ½æ¸…å•**:
- âœ… å¹³å°åˆ†æï¼ˆGMVã€å•†å®¶ã€è®¢é˜…ã€è´¢åŠ¡ï¼‰
- âœ… ç®¡ç†å‘˜æƒé™æ§åˆ¶
- âœ… è·¨å•†å®¶æŸ¥è¯¢ï¼ˆ`--merchant-id`ï¼‰
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- âœ… OpenAPI æ–‡æ¡£
- âœ… åˆ†é¡µå’Œè¿‡æ»¤æ”¯æŒ

**æµ‹è¯•éªŒè¯**:
```bash
# å¹³å°åˆ†æï¼ˆéœ€è¦ admin æƒé™ï¼‰
bi-cli platform overview --month 2024-01
bi-cli platform merchants --segment top --limit 10
bi-cli platform subscription --metrics mrr,arr,churn
bi-cli platform revenue --breakdown

# ç®¡ç†å‘˜è·¨å•†å®¶æŸ¥è¯¢
bi-cli sales get --merchant-id merchant_xxx --days 30
```

---

## ğŸ§ª Phase 3: æµ‹è¯•å’Œéƒ¨ç½²ï¼ˆ1 å‘¨ï¼‰

**ç›®æ ‡**: å®Œæ•´æµ‹è¯•ï¼Œéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

### Week 7: æµ‹è¯•å’Œéƒ¨ç½²

#### 7.1 å•å…ƒæµ‹è¯•
- [ ] bi-backend å•å…ƒæµ‹è¯•
  - [ ] è®¤è¯ä¸­é—´ä»¶æµ‹è¯•
  - [ ] é”€å”®åˆ†ææœåŠ¡æµ‹è¯•
  - [ ] å®¢æˆ·åˆ†ææœåŠ¡æµ‹è¯•
  - [ ] ç¼“å­˜æœåŠ¡æµ‹è¯•
  - [ ] é¢„èšåˆè¡¨æŸ¥è¯¢æœåŠ¡æµ‹è¯•
- [ ] bi-cli å•å…ƒæµ‹è¯•
  - [ ] é…ç½®ç®¡ç†æµ‹è¯•
  - [ ] å‘½ä»¤è§£ææµ‹è¯•
  - [ ] HTTP å®¢æˆ·ç«¯æµ‹è¯•
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 70%

#### 7.2 é›†æˆæµ‹è¯•
- [ ] bi-cli â†’ bi-backend é›†æˆæµ‹è¯•
- [ ] bi-backend â†’ user-auth é›†æˆæµ‹è¯•
- [ ] bi-backend â†’ commerce-backend DB é›†æˆæµ‹è¯•
- [ ] é¢„èšåˆè¡¨ ETL æµç¨‹æµ‹è¯•
- [ ] å¤šå±‚ç¼“å­˜é›†æˆæµ‹è¯•
- [ ] ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•
  - [ ] ç™»å½• â†’ æŸ¥è¯¢é”€å”® â†’ è¾“å‡ºç»“æœ
  - [ ] Token åˆ·æ–°æµç¨‹
  - [ ] å¤šç¯å¢ƒåˆ‡æ¢
  - [ ] ç¼“å­˜å‘½ä¸­å’Œå¤±æ•ˆæµ‹è¯•

#### 7.3 æ€§èƒ½éªŒæ”¶æµ‹è¯•
- [ ] éªŒè¯æ€§èƒ½æŒ‡æ ‡
  - [ ] API å“åº”æ—¶é—´ P50 < 500ms âœ…
  - [ ] API å“åº”æ—¶é—´ P99 < 2s âœ…
  - [ ] ç¼“å­˜å‘½ä¸­ç‡ > 70% âœ…
  - [ ] æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ < 200ms âœ…
- [ ] ç”Ÿæˆæ€§èƒ½æµ‹è¯•æŠ¥å‘Š
- [ ] ä¼˜åŒ–å‰åå¯¹æ¯”åˆ†æ

#### 7.4 éƒ¨ç½²å‡†å¤‡
- [ ] Docker é•œåƒæ„å»º
  - [ ] bi-backend Dockerfile
  - [ ] Docker Compose é…ç½®
- [ ] ç¯å¢ƒå˜é‡é…ç½®
  - [ ] Production ç¯å¢ƒé…ç½®
  - [ ] Stage ç¯å¢ƒé…ç½®
  - [ ] Development ç¯å¢ƒé…ç½®
- [ ] æ•°æ®åº“å‡†å¤‡
  - [ ] åˆ›å»ºåªè¯»æ•°æ®åº“ç”¨æˆ·
  - [ ] éªŒè¯æ•°æ®åº“è¿æ¥æƒé™
- [ ] Redis éƒ¨ç½²
  - [ ] Redis é…ç½®
  - [ ] æŒä¹…åŒ–é…ç½®

#### 6.4 éƒ¨ç½²å’ŒéªŒè¯
- [ ] éƒ¨ç½²åˆ° Stage ç¯å¢ƒ
  - [ ] bi-backend éƒ¨ç½²
  - [ ] éªŒè¯ API å¯è®¿é—®
  - [ ] éªŒè¯è®¤è¯æµç¨‹
- [ ] å‘å¸ƒ bi-cli åˆ° npmï¼ˆbeta ç‰ˆæœ¬ï¼‰
  ```bash
  npm publish --tag beta @optima-chat/bi-cli
  ```
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆStage ç¯å¢ƒï¼‰
- [ ] éƒ¨ç½²åˆ° Production ç¯å¢ƒ
- [ ] å‘å¸ƒ bi-cli åˆ° npmï¼ˆæ­£å¼ç‰ˆæœ¬ï¼‰

#### 6.5 ç›‘æ§å’Œè¿ç»´
- [ ] é…ç½®ç›‘æ§å‘Šè­¦
  - [ ] API å“åº”æ—¶é—´ç›‘æ§
  - [ ] é”™è¯¯ç‡ç›‘æ§
  - [ ] ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§
- [ ] æ—¥å¿—èšåˆå’Œåˆ†æ
- [ ] æ€§èƒ½ç›‘æ§ä»ªè¡¨ç›˜

### Phase 3 äº¤ä»˜ç‰©

**è´¨é‡æŒ‡æ ‡**:
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 70%
- âœ… é›†æˆæµ‹è¯•é€šè¿‡
- âœ… API å“åº”æ—¶é—´ < 2s
- âœ… é”™è¯¯ç‡ < 1%

**éƒ¨ç½²äº§ç‰©**:
- âœ… bi-backend Docker é•œåƒ
- âœ… bi-cli npm åŒ…ï¼ˆ@optima-chat/bi-cliï¼‰
- âœ… éƒ¨ç½²æ–‡æ¡£å’Œè¿ç»´æ‰‹å†Œ
- âœ… ç›‘æ§ä»ªè¡¨ç›˜

---

## ğŸ¯ é‡Œç¨‹ç¢‘å’ŒéªŒæ”¶æ ‡å‡†

### Milestone 1: MVP å®Œæˆï¼ˆWeek 3 ç»“æŸï¼‰

**éªŒæ”¶æ ‡å‡†**:
1. âœ… å•†å®¶å¯ä»¥é€šè¿‡ `bi-cli auth login` å®Œæˆè®¤è¯
2. âœ… å•†å®¶å¯ä»¥æŸ¥è¯¢é”€å”®æ•°æ®ï¼ˆ`bi-cli sales get --days 7`ï¼‰
3. âœ… å•†å®¶å¯ä»¥æŸ¥è¯¢å®¢æˆ·æ•°æ®ï¼ˆ`bi-cli customer get --segment churned`ï¼‰
4. âœ… å•†å®¶å¯ä»¥æŸ¥è¯¢åº“å­˜æ•°æ®ï¼ˆ`bi-cli inventory get --status low`ï¼‰
5. âœ… æ”¯æŒ JSON å’Œ Pretty ä¸¤ç§è¾“å‡ºæ¨¡å¼
6. âœ… Claude Code å¯ä»¥è°ƒç”¨ bi-cli å¹¶è§£æ JSON è¾“å‡º

**æ¼”ç¤ºåœºæ™¯**:
```
å•†å®¶: "å¸®æˆ‘åˆ†ææœ€è¿‘ 7 å¤©çš„é”€å”®æƒ…å†µ"
Claude Code: [è°ƒç”¨ bi-cli sales get --days 7]
Claude Code: "æœ€è¿‘ 7 å¤©é”€å”®é¢ 12.5 ä¸‡ç¾å…ƒï¼ŒåŒæ¯”å¢é•¿ 6%ã€‚
             è®¢å•é‡ 342 å•ï¼Œå®¢å•ä»· 367 ç¾å…ƒã€‚
             å‘¨æœ«é”€é‡è¾ƒé«˜ï¼Œå»ºè®®å¢åŠ åº“å­˜å¤‡è´§ã€‚"
```

### Milestone 2: å¹³å°åŠŸèƒ½å®Œæˆï¼ˆWeek 5 ç»“æŸï¼‰

**éªŒæ”¶æ ‡å‡†**:
1. âœ… ç®¡ç†å‘˜å¯ä»¥æŸ¥è¯¢å¹³å° GMVï¼ˆ`bi-cli platform overview`ï¼‰
2. âœ… ç®¡ç†å‘˜å¯ä»¥åˆ†æå•†å®¶æ´»è·ƒåº¦ï¼ˆ`bi-cli platform merchants --segment active`ï¼‰
3. âœ… ç®¡ç†å‘˜å¯ä»¥æŸ¥è¯¢è®¢é˜… MRRï¼ˆ`bi-cli platform subscription --metrics mrr`ï¼‰
4. âœ… ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æŒ‡å®šå•†å®¶æ•°æ®ï¼ˆ`--merchant-id` å‚æ•°ï¼‰
5. âœ… API å“åº”æ—¶é—´ < 2s
6. âœ… ç¼“å­˜å‘½ä¸­ç‡ > 60%

### Milestone 3: ç”Ÿäº§éƒ¨ç½²ï¼ˆWeek 6 ç»“æŸï¼‰

**éªŒæ”¶æ ‡å‡†**:
1. âœ… bi-backend éƒ¨ç½²åˆ° Production ç¯å¢ƒ
2. âœ… bi-cli å‘å¸ƒåˆ° npmï¼ˆ@optima-chat/bi-cli@1.0.0ï¼‰
3. âœ… Stage ç¯å¢ƒç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡
4. âœ… Production ç¯å¢ƒç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡
5. âœ… ç›‘æ§å’Œå‘Šè­¦é…ç½®å®Œæˆ
6. âœ… æ–‡æ¡£æ›´æ–°å®Œæˆï¼ˆAPI å‚è€ƒã€éƒ¨ç½²æ–‡æ¡£ã€æ•…éšœæ’æŸ¥ï¼‰

---

## ğŸ“Š å·¥ä½œé‡ä¼°ç®—

| é˜¶æ®µ | å¼€å‘ | æµ‹è¯• | æ–‡æ¡£ | æ€»è®¡ |
|------|-----|------|------|------|
| Phase 0 | - | - | 40h | 40h |
| Phase 1 | 80h | 10h | 10h | 100h |
| Phase 2 | 60h | 15h | 5h | 80h |
| Phase 3 | 20h | 20h | 10h | 50h |
| **æ€»è®¡** | **160h** | **45h** | **65h** | **270h** |

**å‡è®¾**:
- 1 äººå…¨èŒå¼€å‘
- æ¯å‘¨å·¥ä½œ 40 å°æ—¶
- æ€»è®¡çº¦ **6-7 å‘¨**

---

## ğŸš§ é£é™©å’Œç¼“è§£æªæ–½

### æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| commerce-backend DB æ¶æ„å˜æ›´ | é«˜ | ä¸­ | ä½¿ç”¨ Prisma è‡ªåŠ¨ç”Ÿæˆ schemaï¼Œå®šæœŸåŒæ­¥ |
| user-auth API å˜æ›´ | é«˜ | ä½ | ç¼–å†™é€‚é…å±‚ï¼Œéš”ç¦»å¤–éƒ¨ä¾èµ– |
| æ€§èƒ½ä¸è¾¾æ ‡ | ä¸­ | ä¸­ | æå‰æ€§èƒ½æµ‹è¯•ï¼Œä¼˜åŒ– SQL æŸ¥è¯¢ï¼Œå¢åŠ ç¼“å­˜ |
| æ•°æ®åº“åªè¯»æƒé™ä¸è¶³ | é«˜ | ä½ | æå‰ä¸ DBA ç¡®è®¤æƒé™ï¼Œåˆ›å»ºä¸“ç”¨åªè¯»ç”¨æˆ· |

### è¿›åº¦é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| éœ€æ±‚å˜æ›´ | ä¸­ | ä¸­ | æ•æ·è¿­ä»£ï¼Œä¼˜å…ˆ MVP åŠŸèƒ½ |
| æŠ€æœ¯éš¾ç‚¹å¡ç‚¹ | ä¸­ | ä¸­ | æå‰æŠ€æœ¯è°ƒç ”ï¼Œé¢„ç•™ç¼“å†²æ—¶é—´ |
| é›†æˆæµ‹è¯•å›°éš¾ | ä½ | ä½ | ä½¿ç”¨ Docker Compose æ¨¡æ‹Ÿå®Œæ•´ç¯å¢ƒ |

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹ï¼ˆæœ¬å‘¨ï¼‰

1. **ç¡®è®¤å¼€å‘è®¡åˆ’**
   - [ ] Review æœ¬è·¯çº¿å›¾
   - [ ] è¯„ä¼°æ—¶é—´å’Œèµ„æº
   - [ ] ç¡®è®¤ä¼˜å…ˆçº§

2. **æ­å»ºé¡¹ç›®åŸºç¡€è®¾æ–½**
   - [ ] åˆ›å»º monorepo ç»“æ„
   - [ ] é…ç½® TypeScriptã€ESLintã€Prettier
   - [ ] åˆå§‹åŒ– bi-backendï¼ˆFastify + Prismaï¼‰
   - [ ] åˆå§‹åŒ– bi-cliï¼ˆCommander.jsï¼‰

3. **è¿æ¥ commerce-backend æ•°æ®åº“**
   - [ ] è·å–åªè¯»æ•°æ®åº“è¿æ¥ä¿¡æ¯
   - [ ] ä½¿ç”¨ Prisma ç”Ÿæˆ schema
   - [ ] éªŒè¯æ•°æ®åº“è¿æ¥

**æœ¬å‘¨ç›®æ ‡**: å®Œæˆ Phase 1 Week 1 çš„æ‰€æœ‰ä»»åŠ¡

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

**MVP æˆåŠŸæ ‡å‡†**:
1. å•†å®¶å¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€ï¼ˆClaude Codeï¼‰æŸ¥è¯¢é”€å”®æ•°æ®
2. è¾“å‡ºæ ¼å¼å‹å¥½ï¼ŒAI å¯è§£æ
3. è®¤è¯å®‰å…¨å¯é ï¼ˆOAuth 2.0ï¼‰
4. æ€§èƒ½æ»¡è¶³éœ€æ±‚ï¼ˆ< 2s å“åº”ï¼‰

**æœ€ç»ˆæˆåŠŸæ ‡å‡†**:
1. å•†å®¶å’Œç®¡ç†å‘˜æ—¥æ´»ä½¿ç”¨
2. Claude Code é›†æˆé¡ºç•…
3. ç³»ç»Ÿç¨³å®šè¿è¡Œï¼ˆ99.9% å¯ç”¨æ€§ï¼‰
4. ç”¨æˆ·æ»¡æ„åº¦é«˜ï¼ˆNPS > 8ï¼‰

---

**è·¯çº¿å›¾ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-01-21
**ç»´æŠ¤è€…**: Optima BI Team
